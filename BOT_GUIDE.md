# ๐ค ุฑุงูููุง ฺฉุงูู ุฑุจุงุช ุจูู

## ุฎูุงุตู ุชุบุฑุงุช

โ **ุฑุจุงุช ฺฉุงูู ุจุง ุซุจุชโูุงู**
- ฺฉุงุฑุจุฑุงู ุงุจุชุฏุง ุฏุฑ ุฑุจุงุช ุซุจุชโูุงู ูโฺฉููุฏ
- ุจุนุฏ ุงุฒ ุซุจุชโูุงู ูโุชูุงููุฏ ูุงุฑุฏ ุจุงุฒ ุดููุฏ
- Leaderboard ูุฑ 30 ุฏููู ุฏุฑ ฺฉุงูุงู ููุงุด ุฏุงุฏู ูโุดูุฏ

## ๐๏ธ ูุนูุงุฑ ุฌุฏุฏ

```
ฺฉุงุฑุจุฑ โ ุฑุจุงุช ุจูู โ ุซุจุชโูุงู โ ูุฑูุฏ ุจู ุจุงุฒ
                    โ
              ูุฑ 30 ุฏููู: Leaderboard ุจู ฺฉุงูุงู
```

## ๐ ูฺฺฏโูุง ุฑุจุงุช

### 1. ุซุจุชโูุงู ฺฉุงุฑุจุฑุงู
- ุฏุฑุงูุช ูุงู
- ุฏุฑุงูุช ูุงู ุฎุงููุงุฏฺฏ
- ุฏุฑุงูุช ฺฉุฏ ุงุณุชุฎุฏุงู
- ุฐุฎุฑู ุฏุฑ ุฏุชุงุจุณ

### 2. ุฏฺฉููโูุง ุงุตู (ุจุนุฏ ุงุฒ ุซุจุชโูุงู)
- ๐ฎ **ุดุฑูุน ุจุงุฒ** - ูุฑูุฏ ุจู ููโุงูพ
- ๐ **ุฑุชุจูโุจูุฏ** - ููุงุด 10 ููุฑ ุจุฑุชุฑ
- ๐ **ุขูุงุฑ ูู** - ููุงุด ุขูุงุฑ ุดุฎุต
- โ **ุฑุงูููุง** - ุชูุถุญุงุช ุจุงุฒ

### 3. Leaderboard ุฎูุฏฺฉุงุฑ
- ูุฑ 30 ุฏููู ุจู ฺฉุงูุงู ุงุฑุณุงู ูโุดูุฏ
- ููุงุด 10 ููุฑ ุจุฑุชุฑ ุจุง ุงูุชุงุฒุงุชุดุงู
- ููุฑุงู ุจุง ุฏฺฉูู ูุฑูุฏ ุจู ุจุงุฒ

## ๐ ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### ฺฏุงู 1: ุชูุธู Environment Variables

ูุฑุงุด ูุงู `.env`:

```bash
# ุงุทูุงุนุงุช ุฑุจุงุช
BALE_BOT_TOKEN=64658763:rgYSwBxd05vEuuuNNbNNYZdtA-T1Gxdx5nw
GAME_URL=https://snake.darmanjoo.ir
CHANNEL_ID=@ุงุณู_ฺฉุงูุงู_ุดูุง  # ID ฺฉุงูุงู ุจุฑุง ุงุฑุณุงู leaderboard
```

### ฺฏุงู 2: Deploy ุจุง Docker

```bash
cd /opt/yalda-snake

# ุงุฌุฑุง ุชูุงู ุณุฑูุณโูุง (App + Bot + Database)
docker-compose up -d --build

# ุจุฑุฑุณ ูุถุนุช
docker-compose ps

# ูุดุงูุฏู ูุงฺฏ ุฑุจุงุช
docker-compose logs -f bot
```

### ฺฏุงู 3: ุชุณุช ุฑุจุงุช

1. ุจู @refahsnakebot ุจุฑูุฏ
2. ุฏุณุชูุฑ `/start` ุฑุง ุจุฒูุฏ
3. ูุฑุงุญู ุซุจุชโูุงู ุฑุง ุท ฺฉูุฏ
4. ุจุนุฏ ุงุฒ ุซุจุชโูุงูุ ุฑู "ุดุฑูุน ุจุงุฒ" ฺฉูฺฉ ฺฉูุฏ

## ๐ฑ ุฌุฑุงู ฺฉุงุฑุจุฑ

### ฺฉุงุฑุจุฑ ุฌุฏุฏ:

```
/start
  โ
"ูุงู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ"
  โ
ฺฉุงุฑุจุฑ: "ุนู"
  โ
"ูุงู ุฎุงููุงุฏฺฏ ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ"
  โ
ฺฉุงุฑุจุฑ: "ุงุญูุฏ"
  โ
"ฺฉุฏ ุงุณุชุฎุฏุงู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ"
  โ
ฺฉุงุฑุจุฑ: "EMP001"
  โ
"โ ุซุจุชโูุงู ุดูุง ุจุง ููููุช ุงูุฌุงู ุดุฏ"
+ ุฏฺฉููโูุง ุงุตู (ุดุฑูุน ุจุงุฒุ ุฑุชุจูโุจูุฏุ ...)
```

### ฺฉุงุฑุจุฑ ูุจู:

```
/start
  โ
"ุณูุงู ุนู ุงุญูุฏ ุนุฒุฒ!"
+ ุฏฺฉููโูุง ุงุตู
```

## ๐ง API Endpoints ุฌุฏุฏ

### 1. ุจุฑุฑุณ ฺฉุงุฑุจุฑ

```http
GET /api/user/:baleUserId

Response:
{
  "id": 1,
  "bale_user_id": "123456",
  "first_name": "ุนู",
  "last_name": "ุงุญูุฏ",
  "employee_code": "EMP001"
}
```

### 2. ุซุจุชโูุงู ฺฉุงุฑุจุฑ

```http
POST /api/register

Body:
{
  "baleUserId": "123456",
  "phoneNumber": "09121234567",
  "firstName": "ุนู",
  "lastName": "ุงุญูุฏ",
  "employeeCode": "EMP001"
}

Response:
{
  "success": true,
  "user": { ... }
}
```

### 3. ุฑุชุจูโุจูุฏ

```http
GET /api/leaderboard/top/:limit

Example: GET /api/leaderboard/top/10

Response:
[
  {
    "first_name": "ุนู",
    "last_name": "ุงุญูุฏ",
    "employee_code": "EMP001",
    "high_score": 1234
  },
  ...
]
```

### 4. ุขูุงุฑ ฺฉุงุฑุจุฑ

```http
GET /api/user/:baleUserId/stats

Response:
{
  "first_name": "ุนู",
  "last_name": "ุงุญูุฏ",
  "employee_code": "EMP001",
  "high_score": 1234,
  "max_length": 45,
  "games_played": 12,
  "rank": 3
}
```

## ๐ Leaderboard ุฎูุฏฺฉุงุฑ

### ุชูุธูุงุช:

- **ูุงุตูู ุฒูุงู:** 30 ุฏููู
- **ุชุนุฏุงุฏ ููุงุด:** 10 ููุฑ ุจุฑุชุฑ
- **ฺฉุงูุงู ูุฏู:** ุชูุธู ุฏุฑ `CHANNEL_ID`

### ูุฑูุช ูพุงู:

```
๐ ุฑุชุจูโุจูุฏ ุจุฑุชุฑู ุจุงุฒฺฉูุงู
โโโโโโโโโโโโโโโโโโโโ

๐ฅ ุนู ุงุญูุฏ
   ๐ฐ 1,234 ุงูุชุงุฒ

๐ฅ ูุฑู ูุญูุฏ
   ๐ฐ 1,150 ุงูุชุงุฒ

๐ฅ ุญุณู ุฑุถุง
   ๐ฐ 1,020 ุงูุชุงุฒ

...

โโโโโโโโโโโโโโโโโโโโ
๐ ุจูโุฑูุฒุฑุณุงู: 14:30

[ุฏฺฉูู: ๐ฎ ุดุฑูุน ุจุงุฒ]
```

## ๐ ูุฏุฑุช ู ูุธุงุฑุช

### ูุดุงูุฏู ูุงฺฏโูุง ุฑุจุงุช

```bash
docker-compose logs -f bot
```

### ุฑโุงุณุชุงุฑุช ุฑุจุงุช

```bash
docker-compose restart bot
```

### ุชููู ุฑุจุงุช

```bash
docker-compose stop bot
```

### ุจุฑุฑุณ ูุถุนุช

```bash
docker-compose ps bot
```

## ๐ ุนุจโุงุจ

### ูุดฺฉู 1: ุฑุจุงุช ูพุงุณุฎ ููโุฏูุฏ

```bash
# ุจุฑุฑุณ ูุงฺฏ
docker-compose logs bot

# ุจุฑุฑุณ ุชูฺฉู ุฏุฑ .env
cat .env | grep BALE_BOT_TOKEN

# ุฑโุงุณุชุงุฑุช
docker-compose restart bot
```

### ูุดฺฉู 2: API ุฎุทุง ูโุฏูุฏ

```bash
# ุจุฑุฑุณ ุงูฺฉู app ุฏุฑ ุญุงู ุงุฌุฑุงุณุช
docker-compose ps app

# ุชุณุช API ุงุฒ ุฏุงุฎู container
docker exec yalda_snake_bot wget -O- http://app:3001/health
```

### ูุดฺฉู 3: Leaderboard ุงุฑุณุงู ููโุดูุฏ

```bash
# ุจุฑุฑุณ CHANNEL_ID ุฏุฑ .env
cat .env | grep CHANNEL_ID

# ูุทูุฆู ุดูุฏ ฺฉู ุฑุจุงุช admin ฺฉุงูุงู ุงุณุช
# ุจู @botfather โ Bot Settings โ Group Privacy โ Turn off
```

## ๐ ุชูุธูุงุช ูพุดุฑูุชู

### ุชุบุฑ ูุงุตูู ุฒูุงู Leaderboard

ุฏุฑ `bot/bot.py`:

```python
# ุฎุท 180
time.sleep(30 * 60)  # 30 ุฏููู

# ุจุฑุง 15 ุฏููู:
time.sleep(15 * 60)

# ุจุฑุง 1 ุณุงุนุช:
time.sleep(60 * 60)
```

ุณูพุณ rebuild:
```bash
docker-compose up -d --build bot
```

### ุชุบุฑ ุชุนุฏุงุฏ ููุงุด ุฏุฑ Leaderboard

ุฏุฑ `bot/bot.py`:

```python
# ุฎุท 165 - ุชุบุฑ ุงุฒ 10 ุจู ุนุฏุฏ ุฏูุฎูุงู
leaderboard = response.json()[:10]

# ูุซูุงู ุจุฑุง 20 ููุฑ:
leaderboard = response.json()[:20]
```

### ุงุฑุณุงู ูพุงู ุฎูุดโุขูุฏฺฏู ุณูุงุฑุด

ูุฑุงุด ูุชู ุฏุฑ `bot/bot.py`:

```python
welcome_text = """
ูุชู ุณูุงุฑุด ุฎูุฏุชุงู...
"""
```

## ๐ฏ ฺฺฉโูุณุช ุฑุงูโุงูุฏุงุฒ

- [ ] ูุงู `.env` ุชูุธู ุดุฏู (ุชูฺฉู ุจุงุชุ ฺฉุงูุงู)
- [ ] Docker containers ุงุฌุฑุง ุดุฏูโุงูุฏ
- [ ] ุฑุจุงุช ุฏุฑ ฺฉุงูุงู admin ุงุณุช
- [ ] ุชุณุช ุซุจุชโูุงู ูููู ุจูุฏู
- [ ] ุฏฺฉููโูุง ฺฉุงุฑ ูโฺฉููุฏ
- [ ] API endpoints ูพุงุณุฎ ูโุฏููุฏ
- [ ] Leaderboard ูุฑ 30 ุฏููู ุงุฑุณุงู ูโุดูุฏ

## ๐ ุฏุณุชูุฑุงุช ููุฏ

### ุงุฑุณุงู ุฏุณุช Leaderboard

```python
# ูุฑูุฏ ุจู container
docker exec -it yalda_snake_bot python

# ุงุฌุฑุง ุชุงุจุน
from bot import post_leaderboard_to_channel
post_leaderboard_to_channel()
```

### ุจุฑุฑุณ ุชุนุฏุงุฏ ฺฉุงุฑุจุฑุงู ุซุจุชโูุงู ุดุฏู

```bash
docker exec yalda_snake_db psql -U snake_user -d yalda_snake -c "SELECT COUNT(*) FROM users;"
```

### ูุดุงูุฏู ุขุฎุฑู ุซุจุชโูุงูโูุง

```bash
docker exec yalda_snake_db psql -U snake_user -d yalda_snake -c "SELECT first_name, last_name, employee_code, created_at FROM users ORDER BY created_at DESC LIMIT 10;"
```

## ๐ ููุงุจุน

- [ูุณุชูุฏุงุช Bale Bot API](https://docs.bale.ai/)
- [Python Bale Bot SDK](https://github.com/python-bale-bot/python-bale-bot)

---

**ููู ฺุฒ ุขูุงุฏู ุงุณุช! ูููู ุจุงุดุฏ! ๐**
